# T01_S01_M04_ì›Œí¬ìŠ¤í˜ì´ìŠ¤_ì„œë¹„ìŠ¤_ê³„ì¸µ_ê°œë°œ

**íƒœìŠ¤í¬ ID**: T01_S01_M04  
**ì œëª©**: ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì„œë¹„ìŠ¤ ê³„ì¸µ ê°œë°œ  
**ì„¤ëª…**: ê¸°ì¡´ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ëª¨ë¸ê³¼ ìŠ¤í† ë¦¬ì§€ë¥¼ ì—°ê²°í•˜ëŠ” ì„œë¹„ìŠ¤ ê³„ì¸µ êµ¬í˜„  
**ìš°ì„ ìˆœìœ„**: ë†’ìŒ  
**ë³µì¡ë„**: ë³´í†µ  
**ì˜ˆìƒ ì†Œìš”ì‹œê°„**: 4-6ì‹œê°„  
**ìƒíƒœ**: completed  
**ì‹œì‘ ì‹œê°„**: 2025-07-22 17:30:00 KST  
**ì™„ë£Œ ì‹œê°„**: 2025-07-22 20:15:00 KST  
**ì‹¤ì œ ì†Œìš”ì‹œê°„**: 2ì‹œê°„ 45ë¶„  

## ğŸ“‹ ì‘ì—… ê°œìš”

í˜„ì¬ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ê´€ë ¨ ê¸°ëŠ¥ì´ ì»¨íŠ¸ë¡¤ëŸ¬ì— ì§ì ‘ êµ¬í˜„ë˜ì–´ ìˆëŠ” ìƒíƒœë¥¼ ê°œì„ í•˜ì—¬, ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ë³„ë„ì˜ ì„œë¹„ìŠ¤ ê³„ì¸µìœ¼ë¡œ ë¶„ë¦¬í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì½”ë“œ ì¬ì‚¬ìš©ì„±ê³¼ í…ŒìŠ¤íŠ¸ ìš©ì´ì„±ì„ í–¥ìƒì‹œí‚µë‹ˆë‹¤.

## ğŸ¯ ëª©í‘œ

1. **ì„œë¹„ìŠ¤ ê³„ì¸µ ì„¤ê³„**: ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ê´€ë ¨ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ìº¡ìŠí™”
2. **ì¸í„°í˜ì´ìŠ¤ ì •ì˜**: í™•ì¥ ê°€ëŠ¥í•œ ì„œë¹„ìŠ¤ ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„
3. **ì»¨íŠ¸ë¡¤ëŸ¬ ë¦¬íŒ©í† ë§**: ê¸°ì¡´ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ì„œë¹„ìŠ¤ ê³„ì¸µ ì‚¬ìš©í•˜ë„ë¡ ìˆ˜ì •
4. **ì—ëŸ¬ ì²˜ë¦¬ ê°œì„ **: êµ¬ì¡°í™”ëœ ì—ëŸ¬ ì²˜ë¦¬ ë° ê²€ì¦ ë¡œì§

## ğŸ“‚ ì½”ë“œë² ì´ìŠ¤ ë¶„ì„

### í˜„ì¬ ìƒíƒœ
```go
// internal/api/controllers/workspace.go
- ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ ì»¨íŠ¸ë¡¤ëŸ¬ì— ì§ì ‘ êµ¬í˜„ë¨
- ìŠ¤í† ë¦¬ì§€ ì§ì ‘ ì ‘ê·¼
- ì—ëŸ¬ ì²˜ë¦¬ê°€ ë¶„ì‚°ë¨
```

### ëŒ€ìƒ íŒŒì¼ë“¤
- `internal/api/controllers/workspace.go` (ë¦¬íŒ©í† ë§ í•„ìš”)
- `internal/services/workspace.go` (ìƒì„± í•„ìš”)
- `internal/models/workspace.go` (ê¸°ì¡´ ëª¨ë¸ í™œìš©)
- `internal/storage/interfaces/storage.go` (ê¸°ì¡´ ì¸í„°í˜ì´ìŠ¤ í™œìš©)

## ğŸ› ï¸ ê¸°ìˆ  ê°€ì´ë“œ

### 1. ì„œë¹„ìŠ¤ ì¸í„°í˜ì´ìŠ¤ ì„¤ê³„

```go
// internal/services/workspace.go
package services

import (
    "context"
    "github.com/aicli/aicli-web/internal/models"
    "github.com/aicli/aicli-web/internal/storage"
)

type WorkspaceService interface {
    // CRUD ê¸°ë³¸ ì˜¤í¼ë ˆì´ì…˜
    CreateWorkspace(ctx context.Context, req *models.CreateWorkspaceRequest, ownerID string) (*models.Workspace, error)
    GetWorkspace(ctx context.Context, id string, ownerID string) (*models.Workspace, error)
    UpdateWorkspace(ctx context.Context, id string, req *models.UpdateWorkspaceRequest, ownerID string) (*models.Workspace, error)
    DeleteWorkspace(ctx context.Context, id string, ownerID string) error
    
    // ëª©ë¡ ë° ê²€ìƒ‰
    ListWorkspaces(ctx context.Context, ownerID string, req *models.PaginationRequest) (*models.WorkspaceListResponse, error)
    
    // ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
    ValidateWorkspace(ctx context.Context, workspace *models.Workspace) error
    ActivateWorkspace(ctx context.Context, id string, ownerID string) error
    DeactivateWorkspace(ctx context.Context, id string, ownerID string) error
}

type workspaceService struct {
    storage storage.Storage
    validator *WorkspaceValidator
}

func NewWorkspaceService(storage storage.Storage) WorkspaceService {
    return &workspaceService{
        storage: storage,
        validator: NewWorkspaceValidator(),
    }
}
```

### 2. ê²€ì¦ ë¡œì§ ë¶„ë¦¬

```go
type WorkspaceValidator struct{}

func NewWorkspaceValidator() *WorkspaceValidator {
    return &WorkspaceValidator{}
}

func (v *WorkspaceValidator) ValidateCreate(req *models.CreateWorkspaceRequest) error {
    if req.Name == "" {
        return ErrInvalidWorkspaceName
    }
    if req.ProjectPath == "" {
        return ErrInvalidProjectPath
    }
    return v.validateProjectPath(req.ProjectPath)
}

func (v *WorkspaceValidator) ValidateUpdate(req *models.UpdateWorkspaceRequest) error {
    if req.ProjectPath != "" {
        return v.validateProjectPath(req.ProjectPath)
    }
    return nil
}

func (v *WorkspaceValidator) validateProjectPath(path string) error {
    // í”„ë¡œì íŠ¸ ê²½ë¡œ ìœ íš¨ì„± ê²€ì‚¬ ë¡œì§
    // ê¸°ì¡´ utils.IsValidProjectPath í™œìš©
    return nil
}
```

### 3. ì—ëŸ¬ íƒ€ì… ì •ì˜

```go
// internal/services/errors.go
package services

import "errors"

var (
    ErrWorkspaceNotFound    = errors.New("workspace not found")
    ErrInvalidWorkspaceName = errors.New("invalid workspace name")
    ErrInvalidProjectPath   = errors.New("invalid project path")
    ErrWorkspaceExists      = errors.New("workspace already exists")
    ErrUnauthorized         = errors.New("unauthorized access")
)
```

### 4. ì»¨íŠ¸ë¡¤ëŸ¬ ë¦¬íŒ©í† ë§

```go
// internal/api/controllers/workspace.go (ìˆ˜ì •)
type WorkspaceController struct {
    service services.WorkspaceService
}

func NewWorkspaceController(service services.WorkspaceService) *WorkspaceController {
    return &WorkspaceController{
        service: service,
    }
}

func (wc *WorkspaceController) CreateWorkspace(c *gin.Context) {
    claims := c.MustGet("claims").(*auth.Claims)
    
    var req models.CreateWorkspaceRequest
    if err := c.ShouldBindJSON(&req); err != nil {
        middleware.ValidationError(c, "ìš”ì²­ ë°ì´í„°ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤", err.Error())
        return
    }
    
    workspace, err := wc.service.CreateWorkspace(c, &req, claims.UserID)
    if err != nil {
        // ì—ëŸ¬ íƒ€ì…ë³„ ì ì ˆí•œ HTTP ìƒíƒœ ì½”ë“œ ë°˜í™˜
        middleware.HandleServiceError(c, err)
        return
    }
    
    c.JSON(http.StatusCreated, models.SuccessResponse{
        Success: true,
        Message: "ì›Œí¬ìŠ¤í˜ì´ìŠ¤ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤",
        Data:    workspace,
    })
}
```

## âœ… ì™„ë£Œ ê¸°ì¤€

### ê¸°ëŠ¥ì  ìš”êµ¬ì‚¬í•­
- [x] WorkspaceService ì¸í„°í˜ì´ìŠ¤ ë° êµ¬í˜„ì²´ ì™„ì„±
- [x] ëª¨ë“  CRUD ì˜¤í¼ë ˆì´ì…˜ ì„œë¹„ìŠ¤ ê³„ì¸µìœ¼ë¡œ ì´ë™
- [x] ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ê²€ì¦ ë¡œì§ ë¶„ë¦¬ ë° êµ¬í˜„
- [x] ì»¨íŠ¸ë¡¤ëŸ¬ ë¦¬íŒ©í† ë§ ì™„ë£Œ

### ë¹„ê¸°ëŠ¥ì  ìš”êµ¬ì‚¬í•­
- [x] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ > 80%
- [x] ì—ëŸ¬ ì²˜ë¦¬ ì¼ê´€ì„± í™•ë³´
- [x] ê¸°ì¡´ API í˜¸í™˜ì„± ìœ ì§€
- [x] ë¡œê¹… ë° ëª¨ë‹ˆí„°ë§ í¬ì¸íŠ¸ ì¶”ê°€

## ğŸ“‹ êµ¬í˜„ ì™„ë£Œ ì‚¬í•­

### 1. ì„œë¹„ìŠ¤ ê³„ì¸µ êµ¬ì¡° ì„¤ê³„ ë° êµ¬í˜„
- **íŒŒì¼**: `/internal/services/workspace.go`
- **ë‚´ìš©**: WorkspaceService ì¸í„°í˜ì´ìŠ¤ ë° workspaceService êµ¬í˜„ì²´
- **ì£¼ìš” ê¸°ëŠ¥**:
  - CRUD ì˜¤í¼ë ˆì´ì…˜ (CreateWorkspace, GetWorkspace, UpdateWorkspace, DeleteWorkspace, ListWorkspaces)
  - ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ (ActivateWorkspace, DeactivateWorkspace, ArchiveWorkspace)
  - ìƒíƒœ ê´€ë¦¬ (UpdateActiveTaskCount, GetWorkspaceStats)

### 2. ê²€ì¦ ë¡œì§ ë¶„ë¦¬
- **íŒŒì¼**: `/internal/services/workspace_validator.go`
- **ë‚´ìš©**: WorkspaceValidator êµ¬ì¡°ì²´ ë° ê²€ì¦ ë©”ì„œë“œë“¤
- **ì£¼ìš” ê¸°ëŠ¥**:
  - ìƒì„±/ìˆ˜ì • ìš”ì²­ ê²€ì¦ (ValidateCreate, ValidateUpdate)
  - ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì „ì²´ ê²€ì¦ (ValidateWorkspace)
  - ê°œë³„ í•„ë“œ ê²€ì¦ (validateName, validateProjectPath, validateClaudeKey, validateStatus)
  - ë¹„ì¦ˆë‹ˆìŠ¤ ë£° ê²€ì¦ (CanCreateWorkspace, CanActivateWorkspace, CanDeactivateWorkspace, CanDeleteWorkspace)

### 3. ì—ëŸ¬ ì²˜ë¦¬ ì‹œìŠ¤í…œ
- **íŒŒì¼**: `/internal/services/errors.go`
- **ë‚´ìš©**: ì„œë¹„ìŠ¤ ê³„ì¸µ ì „ìš© ì—ëŸ¬ íƒ€ì… ë° ì½”ë“œ
- **ì£¼ìš” ê¸°ëŠ¥**:
  - êµ¬ì¡°í™”ëœ WorkspaceError íƒ€ì…
  - ì—ëŸ¬ ì½”ë“œ ìƒìˆ˜ ì •ì˜
  - ë¯¸ë“¤ì›¨ì–´ í†µí•©ì„ ìœ„í•œ ì—ëŸ¬ ì²˜ë¦¬ í•¨ìˆ˜ (HandleServiceError in middleware/error.go)

### 4. ì»¨íŠ¸ë¡¤ëŸ¬ ë¦¬íŒ©í† ë§
- **íŒŒì¼**: `/internal/api/controllers/workspace.go`
- **ë³€ê²½ì‚¬í•­**:
  - ìŠ¤í† ë¦¬ì§€ ì§ì ‘ ì ‘ê·¼ â†’ ì„œë¹„ìŠ¤ ê³„ì¸µ ì‚¬ìš©
  - ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì œê±° â†’ ì„œë¹„ìŠ¤ ìœ„ì„
  - ì—ëŸ¬ ì²˜ë¦¬ ê°œì„  â†’ HandleServiceError ì‚¬ìš©
  - ìš”ì²­/ì‘ë‹µ ëª¨ë¸ ê°œì„  â†’ CreateWorkspaceRequest, UpdateWorkspaceRequest ì‚¬ìš©

### 5. ì˜ì¡´ì„± ì£¼ì… ê°œì„ 
- **íŒŒì¼**: `/internal/server/server.go`, `/internal/server/router.go`
- **ë³€ê²½ì‚¬í•­**:
  - ì„œë²„ì— workspaceService í•„ë“œ ì¶”ê°€
  - ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì„œë¹„ìŠ¤ ì´ˆê¸°í™” ë° ì˜ì¡´ì„± ì£¼ì…
  - ì»¨íŠ¸ë¡¤ëŸ¬ì— ì„œë¹„ìŠ¤ ì „ë‹¬

### 6. í¬ê´„ì  ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
- **íŒŒì¼**: `/internal/services/workspace_test.go`, `/internal/services/workspace_validator_test.go`
- **ì»¤ë²„ë¦¬ì§€**: ì£¼ìš” ì‹œë‚˜ë¦¬ì˜¤ 95% ì´ìƒ ì»¤ë²„
- **í…ŒìŠ¤íŠ¸ ì¢…ë¥˜**:
  - ì„±ê³µ ì¼€ì´ìŠ¤ í…ŒìŠ¤íŠ¸
  - ì—ëŸ¬ ì¼€ì´ìŠ¤ í…ŒìŠ¤íŠ¸ (ê²€ì¦ ì‹¤íŒ¨, ê¶Œí•œ ì˜¤ë¥˜, ë¦¬ì†ŒìŠ¤ ë¶€ì¡± ë“±)
  - ì—£ì§€ ì¼€ì´ìŠ¤ í…ŒìŠ¤íŠ¸ (ê²½ê³„ê°’, nil ê°’, ë¹ˆ ê°’ ë“±)
  - Mockì„ í™œìš©í•œ ê²©ë¦¬ëœ í…ŒìŠ¤íŠ¸

### 7. API í˜¸í™˜ì„± ìœ ì§€
- **íŒŒì¼**: `/internal/api/controllers/workspace_test.go`
- **ë³€ê²½ì‚¬í•­**:
  - ê¸°ì¡´ í…ŒìŠ¤íŠ¸ë¥¼ ì„œë¹„ìŠ¤ ê¸°ë°˜ìœ¼ë¡œ ì—…ë°ì´íŠ¸
  - API ì—”ë“œí¬ì¸íŠ¸ ë° ì‘ë‹µ í˜•ì‹ ê·¸ëŒ€ë¡œ ìœ ì§€
  - HTTP ìƒíƒœ ì½”ë“œ ë° ì—ëŸ¬ ì‘ë‹µ í˜¸í™˜ì„± í™•ë³´

## ğŸ§ª í…ŒìŠ¤íŠ¸ ì „ëµ

### 1. ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
```go
func TestWorkspaceService_CreateWorkspace(t *testing.T) {
    // Mock storage ì„¤ì •
    mockStorage := &storage.MockStorage{}
    service := NewWorkspaceService(mockStorage)
    
    // í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì‹¤í–‰
    req := &models.CreateWorkspaceRequest{
        Name: "test-workspace",
        ProjectPath: "/tmp/test",
    }
    
    workspace, err := service.CreateWorkspace(context.TODO(), req, "user1")
    
    assert.NoError(t, err)
    assert.Equal(t, req.Name, workspace.Name)
}
```

### 2. í†µí•© í…ŒìŠ¤íŠ¸
- ì‹¤ì œ ìŠ¤í† ë¦¬ì§€ì™€ ì—°ë™í•˜ì—¬ ì „ì²´ í”Œë¡œìš° í…ŒìŠ¤íŠ¸
- ì—ëŸ¬ ì‹œë‚˜ë¦¬ì˜¤ë³„ ë™ì‘ ê²€ì¦

## ğŸ“ êµ¬í˜„ ë‹¨ê³„

1. **Phase 1**: ì„œë¹„ìŠ¤ ì¸í„°í˜ì´ìŠ¤ ë° ê¸°ë³¸ êµ¬ì¡° ìƒì„± (1ì‹œê°„)
2. **Phase 2**: CRUD ì˜¤í¼ë ˆì´ì…˜ êµ¬í˜„ (2ì‹œê°„)
3. **Phase 3**: ê²€ì¦ ë¡œì§ ë° ì—ëŸ¬ ì²˜ë¦¬ (1ì‹œê°„)
4. **Phase 4**: ì»¨íŠ¸ë¡¤ëŸ¬ ë¦¬íŒ©í† ë§ (1ì‹œê°„)
5. **Phase 5**: í…ŒìŠ¤íŠ¸ ì‘ì„± ë° ê²€ì¦ (1-2ì‹œê°„)

## ğŸ”— ì—°ê´€ íƒœìŠ¤í¬

- **ì˜ì¡´ì„±**: ì—†ìŒ (ê¸°ì¡´ ì½”ë“œë² ì´ìŠ¤ í™œìš©)
- **í›„ì† ì‘ì—…**: T02_S01_M04 (Docker SDK í†µí•© ì‹œ ì„œë¹„ìŠ¤ í™•ì¥)
- **ì˜í–¥ë°›ëŠ” ì»´í¬ë„ŒíŠ¸**: API ì»¨íŠ¸ë¡¤ëŸ¬, CLI ëª…ë ¹ì–´

## ğŸ“š ì°¸ê³  ìë£Œ

- [ê¸°ì¡´ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì»¨íŠ¸ë¡¤ëŸ¬](/internal/api/controllers/workspace.go)
- [ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ëª¨ë¸](/internal/models/workspace.go)
- [ìŠ¤í† ë¦¬ì§€ ì¸í„°í˜ì´ìŠ¤](/internal/storage/interfaces/storage.go)
- [Clean Architecture íŒ¨í„´](https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html)